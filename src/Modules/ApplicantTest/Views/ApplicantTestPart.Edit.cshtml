@using ApplicantTest.Models
@model ApplicantTestPart

<!DOCTYPE html>
<html>
<head>
    <style>
        html, body {
            height: 100%;
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .scoreboard {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f8f8f8;
            padding: 5px 10px;
            border-top: 1px solid #ddd;
            font-size: 12px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }

            .scoreboard div {
                margin: 0 10px;
            }

        .iframe-container {
            width: 100%;
            height: 44rem;
            border: 2px solid black;
        }

            .iframe-container iframe {
                width: 100%;
                height: 100%;
                border: none;
            }

        #startTest {
            margin: 10px;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const emailSentField = document.getElementById('EmailSent');
            const messageSentToAsakoSatoshiField = document.getElementById('MessageSentToAsakoSatoshi');
            const messageSentToLilyWangField = document.getElementById('MessageSentToLilyWang');
            const messageSentToMadisonByersField = document.getElementById('MessageSentToMadisonByers');
            const messageSentToDominicGonzalezField = document.getElementById('MessageSentToDominicGonzalez');
            const messageSentToSimoneKhanField = document.getElementById('MessageSentToSimoneKhan');
            const bookmarkClickedField = document.getElementById('BookmarkClicked');
            const formSubmittedField = document.getElementById('FormSubmitted');
            const usernameField = document.getElementById('UserName');
            const form = document.getElementById('eventForm');

            async function updateFootsteps(field) {
                field.value = parseInt(field.value) + 1;
                console.log(`Updating field: ${field.name} to value: ${field.value}`);
                form.submit();
            }

            function updateScoreboard() {
                console.log('Updating scoreboard');
                document.getElementById('emailSentScore').innerText = emailSentField.value;
                document.getElementById('messageSentToAsakoSatoshiScore').innerText = messageSentToAsakoSatoshiField.value;
                document.getElementById('messageSentToLilyWangScore').innerText = messageSentToLilyWangField.value;
                document.getElementById('messageSentToMadisonByersScore').innerText = messageSentToMadisonByersField.value;
                document.getElementById('messageSentToDominicGonzalezScore').innerText = messageSentToDominicGonzalezField.value;
                document.getElementById('messageSentToSimoneKhanScore').innerText = messageSentToSimoneKhanField.value;
                document.getElementById('bookmarkClickedScore').innerText = bookmarkClickedField.value;
                document.getElementById('formSubmittedScore').innerText = formSubmittedField.value;
            }

            window.addEventListener('message', (event) => {
                console.log('Received message:', event);
                if (event.data && event.data.event === 'emailSent') {
                    console.log('Email sent event captured in the parent document!', event.data.details);
                    updateFootsteps(emailSentField);
                } else if (event.data && event.data.event === 'messageSent') {
                    console.log('Message sent event captured in the parent document!', event.data.details);
                    updateFootsteps(messageSentToAsakoSatoshiField);
                } else if (event.data && event.data.event === 'bookmarkClicked') {
                    console.log('Bookmark clicked event captured in the parent document!', event.data.details);
                    updateFootsteps(bookmarkClickedField);
                } else if (event.data && event.data.event === 'formSubmitted') {
                    console.log('Form submitted event captured in the parent document!', event.data.details);
                    updateFootsteps(formSubmittedField);
                } else {
                    console.log('Unknown event received:', event.data);
                }
            });

            updateScoreboard();
            document.getElementById('startTest').addEventListener('click', () => {
                console.log('Test started for user:', usernameField.value);
            });

            document.getElementById('finishTest').addEventListener('click', () => {
                console.log('Test finished for user:', usernameField.value);
            });
        });
    </script>
</head>
<body>
    <div class="iframe-container">
        <iframe src="/ApplicantTest/ApplicantTest/index.html" onload="console.log('iFrame loaded successfully.')" onerror="console.error('Error loading iFrame.');"></iframe>
    </div>
    <form id="eventForm" method="post">
        <input type="hidden" id="EmailSent" name="EmailSent" value="0" />
        <input type="hidden" id="MessageSentToAsakoSatoshi" name="MessageSentToAsakoSatoshi" value="0" />
        <input type="hidden" id="MessageSentToLilyWang" name="MessageSentToLilyWang" value="0" />
        <input type="hidden" id="MessageSentToMadisonByers" name="MessageSentToMadisonByers" value="0" />
        <input type="hidden" id="MessageSentToDominicGonzalez" name="MessageSentToDominicGonzalez" value="0" />
        <input type="hidden" id="MessageSentToSimoneKhan" name="MessageSentToSimoneKhan" value="0" />
        <input type="hidden" id="BookmarkClicked" name="BookmarkClicked" value="0" />
        <input type="hidden" id="FormSubmitted" name="FormSubmitted" value="0" />
        <input type="text" id="UserName" name="UserName" placeholder="Enter your username" required />
        <button type="button" id="startTest">Start Test</button>
        <button type="button" id="finishTest">Finish Test</button>
    </form>
    <div class="scoreboard">
        <div>Email Sent: <span id="emailSentScore">0</span></div>
        <div>Message Sent to Asako Satoshi: <span id="messageSentToAsakoSatoshiScore">0</span></div>
        <div>Message Sent to Lily Wang: <span id="messageSentToLilyWangScore">0</span></div>
        <div>Message Sent to Madison Byers: <span id="messageSentToMadisonByersScore">0</span></div>
        <div>Message Sent to Dominic Gonzalez: <span id="messageSentToDominicGonzalezScore">0</span></div>
        <div>Message Sent to Simone Khan: <span id="messageSentToSimoneKhanScore">0</span></div>
        <div>Bookmark Clicked: <span id="bookmarkClickedScore">0</span></div>
        <div>Form Submitted: <span id="formSubmittedScore">0</span></div>
    </div>
</body>
</html>
